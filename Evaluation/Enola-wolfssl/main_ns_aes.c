#include <arm_cmse.h>
#include "RTE_Components.h"                        /* Component selection */
#include CMSIS_device_header
#include "Secure_Functions.h"     /* Secure Code Entry Points */
#include "enola-measurement.h"
#include "simple-crypto.h"
#include "hash.h"
#include "rsa.h"
#include "aes.h"


  
  uint8_t plaintext[] = {0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c,
                         0x1a, 0x1b, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0xa, 0xb, 0x1c, 0x2d, 0xe, 0xf, 0x2d, 0x4c};
  
  uint8_t key[] = {0x12, 0xc2, 0x5d, 0x66, 0x67, 0x66, 0x27, 0x68, 0x12, 0xc2, 0x5d, 0x66, 0x67, 0x66, 0x27, 0x68, 0x12, 0xc2, 0x5d, 0x66, 0x67, 0x66, 0x27, 0x68, 0x12, 0xc2, 0x5d, 0x66, 0x67, 0x66, 0x27, 0x68};
  uint8_t ciphertext[1024];

static uint32_t x;

int main (void)
{
    /* exercise some core register from Non Secure Mode */
  x = __get_MSP();
  x = __get_PSP();

  SystemCoreClockUpdate();

    /*AES 128-bit test*/
   Aes ctx;

   size_t len = 1024;
   int result; // Library result
    if (len <= 0 || len % BLOCK_SIZE)
        return -1;
   result = wc_AesSetKey(&ctx, key, 16, NULL, AES_ENCRYPTION);
    if (result != 0)
        return result; // Report error
       // Encrypt each block
    for (int i = 0; i < len - 1; i += BLOCK_SIZE) {
        result = wc_AesEncryptDirect(&ctx, ciphertext + i, plaintext + i);
        if (result != 0)
            return result; // Report error
    }
    memset(plaintext, 0, 32*32);
        // Decrypt each block
    result = wc_AesSetKey(&ctx, key, 16, NULL, AES_DECRYPTION);
    for (int i = 0; i < len - 1; i += BLOCK_SIZE) {
        result = wc_AesDecryptDirect(&ctx, plaintext + i, ciphertext + i);
        if (result != 0)
            return result; // Report error
    }
    print_occurence_trace();
}